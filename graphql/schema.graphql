scalar Time

enum RoleType {
  SELLER
  BUYER
}

# Define the directive
directive @hasRole(role: [RoleType!]!) on FIELD_DEFINITION

interface BaseInfo {
    email: String!
    first_name: String!
    last_name: String!
    phone: String!
    address: String!
}

type RefreshToken {
    token: String!
    refresh_token: String!
}

type AccountBuyer implements BaseInfo {
    orders: [Order!]!

    email: String!
    first_name: String!
    last_name: String!
    phone: String!
    address: String!
}

type AccountSeller implements BaseInfo {
    store_name: String!
    products: [Product!]!

    email: String!
    first_name: String!
    last_name: String!
    phone: String!
    address: String!
}

type Product {
    id: String!
    name: String!
    description: String!
    price: Float!
    quantity: Int!

    seller_id: String!
}

type OrderProduct {
    product: Product!
    quantity: Int!
}

type Order {
    id: String!
    account: AccountBuyer!
    products: [OrderProduct!]!
    total_price: Float!
    created_at: Time!
    address: String!
}

input PaginationInput {
    skip: Int!
    take: Int!
}

input BaseInfoInput {
    email: String
    first_name: String!
    last_name: String!
    phone: String!
    address: String!
}

input AccountSellerInput {
    store_name: String!
    base_info: BaseInfoInput!
}

input AccountBuyerInput {
    base_info: BaseInfoInput!
}

input ProductInput {
    name: String!
    description: String!
    price: Float!
    quantity: Int!
}

input OrderProductInput {
    product_id: String!
    quantity: Int!
}

input OrderInput {
    products: [OrderProductInput!]!
    address: String!
}

union LoginResult = AccountBuyer | AccountSeller

type Mutation {
    createAccountSeller(account: AccountSellerInput!): AccountSeller! @hasRole(role: [SELLER])
    updateAccountSeller(account: AccountSellerInput!): AccountSeller! @hasRole(role: [SELLER])

    createAccountBuyer(account: AccountBuyerInput!): AccountBuyer! @hasRole(role: [BUYER])
    updateAccountBuyer(account: AccountBuyerInput!): AccountBuyer! @hasRole(role: [BUYER])

    createUser(email: String!, password: String!, role: RoleType!): String!
    loginUser(email: String!, password: String!): LoginResult!
    refrehToken(token: String!): RefreshToken!

    createProduct(product: ProductInput!): Product! @hasRole(role: [SELLER])
    updateProduct(product: ProductInput!, id: String!): Product! @hasRole(role: [SELLER])
    deleteProduct(id: String!): String! @hasRole(role: [SELLER])

    createOrder(order: OrderInput!): Order!
    deleteOrder(id: String!): String!
}

type Query {
    getProfileBuyer: AccountBuyer! @hasRole(role: [BUYER])
    getProfileSeller: AccountSeller! @hasRole(role: [SELLER])
    getSeller(id: String!): AccountSeller! @hasRole(role: [BUYER, SELLER])
    getBuyer(id: String!): AccountBuyer! @hasRole(role: [SELLER])
    getSellers(pagination: PaginationInput, id:[String!]): [AccountSeller!]! @hasRole(role: [BUYER, SELLER])

    getProducts(pagination: PaginationInput, query: String, id: String): [Product!]! @hasRole(role: [BUYER, SELLER])
    getOrders(id: String): [Order!]! @hasRole(role: [BUYER, SELLER])
}

